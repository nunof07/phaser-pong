!function(t){"use strict";function e(e,i){var a=function(e){return e instanceof t.Loader?e:e instanceof t.State?e.game.load:e.load}(e);return i.image&&i.image.forEach(function(t){a.image(t.key,t.url)}),i.audio&&i.audio.forEach(function(t){a.audio(t.key,t.urls)}),i.bitmapFont&&i.bitmapFont.forEach(function(t){a.bitmapFont(t.key,t.textureUrl,t.atlasUrl)}),a}function i(e){var i=function(e){return e instanceof t.Game?e:e.game}(e);return i.antialias=!1,i.stage.smoothed=!1,t.Canvas.setImageRenderingCrisp(i.canvas),i}function a(e){var i=function(e){return e instanceof t.ScaleManager?e:(t.State,e.scale)}(e);return i.scaleMode=t.ScaleManager.SHOW_ALL,i.fullScreenScaleMode=t.ScaleManager.SHOW_ALL,i.pageAlignHorizontally=!0,i.pageAlignVertically=!0,i.forceLandscape=!0,i.windowConstraints.bottom="visual",i.refresh(),i}var s,n,r,o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},h=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),u=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},l=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},c=function(t){function s(t,e){o(this,s);var i=l(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return i.nextState=t,i.assets=e,i}return u(s,t),h(s,[{key:"init",value:function(){a(this),i(this)}},{key:"preload",value:function(){e(this,this.assets)}},{key:"update",value:function(){this.game.state.start(this.nextState)}}]),s}(t.State),d=function(){function t(){o(this,t)}return h(t,[{key:"bool",value:function(){return Math.random()>=.5}}]),t}(),p=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new d;o(this,t),this.state=e,this.velocity=i,this.isLaunched=!1,this.randomizer=s,this.goLeft=a}return h(t,[{key:"create",value:function(){this.phaserSprite=this.state.game.add.sprite(this.state.game.world.centerX,this.state.game.world.centerY,"ball"),this.sprite.anchor.setTo(.5,.5),this.state.game.physics.arcade.enable(this.sprite),this.spriteBody.collideWorldBounds=!0,this.spriteBody.bounce.setTo(1,1)}},{key:"reset",value:function(t){this.sprite.x=this.state.game.world.centerX,this.sprite.y=this.state.game.world.centerY,this.spriteBody.velocity.setTo(0,0),this.isLaunched=!1,this.goLeft=t}},{key:"launch",value:function(){var t=this.goLeft?-1:1,e=this.randomizer.bool()?-1:1;this.spriteBody.velocity.x=t*this.velocity,this.spriteBody.velocity.y=e*this.velocity,this.isLaunched=!0}},{key:"toggle",value:function(){return this.isLaunched?(this.reset(this.goLeft),!1):(this.launch(),!0)}},{key:"spriteBody",get:function(){return this.phaserSprite.body}},{key:"sprite",get:function(){return this.phaserSprite}}]),t}(),y=function(){function t(e){o(this,t),this.state=e,this.value=0}return h(t,[{key:"create",value:function(t,e){this.bitmap=this.state.game.add.bitmapText(Math.floor(t),Math.floor(e),"Press Start 2P","0",32)}},{key:"increase",value:function(){this.value+=1,this.bitmap.text=""+this.value}}]),t}(),f=function(){function t(e,i,a){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:250,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new y(e);o(this,t),this.state=e,this.paddleObj=i,this.ball=a,this.maxVelocity=s,this.scoreObj=n}return h(t,[{key:"create",value:function(){this.paddleObj.create(this.state.game.world.width-8,this.state.game.world.centerY),this.scoreObj.create(this.state.game.world.width-128,128)}},{key:"update",value:function(){this.paddleBody.velocity.setTo(this.ballBody.velocity.y),this.paddleBody.velocity.x=0,this.paddleBody.maxVelocity.y=this.maxVelocity}},{key:"paddleBody",get:function(){return this.paddleObj.sprite.body}},{key:"ballBody",get:function(){return this.ball.sprite.body}},{key:"paddle",get:function(){return this.paddleObj}},{key:"score",get:function(){return this.scoreObj}}]),t}(),g=function(){function t(e,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new y(e);o(this,t),this.state=e,this.paddleObj=i,this.scoreObj=a}return h(t,[{key:"create",value:function(){this.paddleObj.create(0,this.state.game.world.centerY),this.scoreObj.create(128,128)}},{key:"update",value:function(){this.paddleObj.move(this.state.game.input.y)}},{key:"paddle",get:function(){return this.paddleObj}},{key:"score",get:function(){return this.scoreObj}}]),t}(),b=function(){function t(e){o(this,t),this.state=e}return h(t,[{key:"create",value:function(){this.sound=this.state.game.add.audio("music")}},{key:"toggle",value:function(t){return t?(this.sound.paused?this.sound.resume():this.sound.play(),!0):(this.sound.pause(),!1)}},{key:"pause",value:function(){this.sound.pause()}}]),t}(),m=function(){function t(e){o(this,t),this.state=e}return h(t,[{key:"create",value:function(t,e){this.phaserSprite=this.state.game.add.sprite(t,e,"paddle"),this.phaserSprite.anchor.setTo(.5,.5),this.state.game.physics.arcade.enable(this.phaserSprite),this.spriteBody.collideWorldBounds=!0,this.spriteBody.immovable=!0,this.phaserSprite.scale.setTo(.5,.5),this.minY=.5*this.phaserSprite.height,this.maxY=this.state.game.world.height-.5*this.phaserSprite.height}},{key:"move",value:function(t){this.phaserSprite.y=t,this.phaserSprite.y<this.minY?this.phaserSprite.y=this.minY:this.phaserSprite.y>this.maxY&&(this.phaserSprite.y=this.maxY)}},{key:"spriteBody",get:function(){return this.phaserSprite.body}},{key:"sprite",get:function(){return this.phaserSprite}}]),t}(),v=function(e){function i(){o(this,i);var e=l(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.ball=new p(e),e.players=[new g(e,new m(e)),new f(e,new m(e),e.ball)],e.music=new b(e),e.scored=new t.Signal,e}return u(i,e),h(i,[{key:"create",value:function(){var t=this;this.music.create(),this.ball.create(),this.players.forEach(function(t){t.create()}),this.game.input.onDown.add(function(){t.music.toggle(t.ball.toggle())},this)}},{key:"update",value:function(){var t=this;this.players.forEach(function(e){e.update(),t.game.physics.arcade.collide(e.paddle.sprite,t.ball.sprite,function(){return t.game.sound.play("hit")})}),(this.ballBody.blocked.up||this.ballBody.blocked.down)&&this.game.sound.play("wall"),this.ballBody.blocked.left&&this.score(this.players[1],!1),this.ballBody.blocked.right&&this.score(this.players[0],!0)}},{key:"score",value:function(t,e){t.score.increase(),this.game.sound.play("score"),this.ball.reset(e),this.music.pause(),this.scored.dispatch(t,e)}},{key:"ballBody",get:function(){return this.ball.sprite.body}}]),i}(t.State);(s=new Phaser.Game({width:1024,height:576,renderer:Phaser.AUTO,parent:"game-container"}),n={boot:new c("game",{image:[{key:"paddle",url:"images/paddle.png"},{key:"ball",url:"images/ball.png"}],bitmapFont:[{key:"Press Start 2P",textureUrl:"fonts/Press_Start_2P_0.png",atlasUrl:"fonts/Press_Start_2P.fnt"}],audio:[{key:"hit",urls:["audio/hit.wav"]},{key:"score",urls:["audio/score.wav"]},{key:"wall",urls:["audio/wall.wav"]},{key:"music",urls:["audio/at-night-psg.mp3","audio/at-night-psg.ogg"]}]}),game:new v},r=function(e){return e instanceof t.StateManager?e:e.state}(s),Object.keys(n).forEach(function(t){r.add(t,n[t])}),r).start("boot")}(Phaser);
