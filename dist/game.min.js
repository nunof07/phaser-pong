!function(t){"use strict";function e(e,n){var i=function(e){return e instanceof t.Loader?e:e instanceof t.State?e.game.load:e.load}(e);return n.image&&n.image.forEach(function(t){i.image(t.key,t.url)}),n.audio&&n.audio.forEach(function(t){i.audio(t.key,t.urls)}),n.bitmapFont&&n.bitmapFont.forEach(function(t){i.bitmapFont(t.key,t.textureUrl,t.atlasUrl)}),i}function n(e){var n=function(e){return e instanceof t.Game?e:e.game}(e);return n.antialias=!1,n.stage.smoothed=!1,t.Canvas.setImageRenderingCrisp(n.canvas),n}function i(e){var n=function(e){return e instanceof t.ScaleManager?e:(t.State,e.scale)}(e);return n.scaleMode=t.ScaleManager.SHOW_ALL,n.fullScreenScaleMode=t.ScaleManager.SHOW_ALL,n.pageAlignHorizontally=!0,n.pageAlignVertically=!0,n.forceLandscape=!0,n.windowConstraints.bottom="visual",n.refresh(),n}var a=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},o=function(t){function o(t,e){a(this,o);var n=s(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return n.nextState=t,n.assets=e,n}return u(o,t),r(o,[{key:"init",value:function(){i(this),n(this)}},{key:"preload",value:function(){e(this,this.assets)}},{key:"update",value:function(){this.game.state.start(this.nextState)}}]),o}(t.State);var l=function(){function t(){a(this,t),this.collection=[]}return r(t,[{key:"add",value:function(t){return this.collection.push(t),this}},{key:"values",value:function(){return this.collection}}]),t}(),c=function(){function t(e){a(this,t),this.val=e}return r(t,[{key:"value",value:function(){return this.val()}}]),t}(),h=function(){function t(e){a(this,t),this.sound=e}return r(t,[{key:"play",value:function(){return this.sound.paused?this.sound.resume():this.sound.play(),this}},{key:"pause",value:function(){return this.sound.pause(),this}},{key:"update",value:function(){return this}}]),t}(),d=function(){function t(e){a(this,t),this.factory=e}return r(t,[{key:"create",value:function(){var t=new h(this.factory.value().audio("music"));return t.play(),t}}]),t}(),f=function(){function t(e){a(this,t),this.sound=e}return r(t,[{key:"playHit",value:function(){return this.sound.play("hit"),this}},{key:"playScore",value:function(){return this.sound.play("score"),this}},{key:"playWall",value:function(){return this.sound.play("wall"),this}},{key:"update",value:function(){return this}}]),t}(),v=function(){function t(e,n,i,r){a(this,t),this.sound=e,this.ball=n,this.ballPaddleCollsion=i,this.referee=r}return r(t,[{key:"create",value:function(){var t=new f(this.sound.value());return this.ballPaddleCollsion.value().collided().add(function(){t.playHit()}),this.referee.value().scored().add(function(){t.playScore()}),this.ball.value().blocked().add(function(e){(e.up||e.down)&&t.playWall()}),t}}]),t}(),y=function(){function t(){a(this,t)}return r(t,[{key:"value",value:function(){return this.val}},{key:"update",value:function(t){return this.val=t,this}}]),t}();function p(t){return t.body}var b=function(){function e(n,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.Signal,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:510,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];a(this,e),this.world=n,this.spriteObj=i,this.blockedObj=r,this.velocity=u,this.goLeft=s,this.isLaunchedFlag=!1}return r(e,[{key:"reset",value:function(t){return this.spriteObj.x=this.world.centerX,this.spriteObj.y=this.world.centerY,this.body().velocity.setTo(0,0),this.goLeft=void 0===t?this.goLeft:t,this.isLaunchedFlag=!1,this}},{key:"launch",value:function(){var t=this.goLeft?-1:1,e=Math.random()>=.5?-1:1;return this.body().velocity.x=t*this.velocity,this.body().velocity.y=e*this.velocity,this.isLaunchedFlag=!0,this}},{key:"isLaunched",value:function(){return this.isLaunchedFlag}},{key:"sprite",value:function(){return this.spriteObj}},{key:"body",value:function(){return p(this.spriteObj)}},{key:"blocked",value:function(){return this.blockedObj}},{key:"update",value:function(){return this.body().blocked.none||this.blockedObj.dispatch(this.body().blocked),this}}]),e}(),g=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y;a(this,t),this.game=e,this.last=n}return r(t,[{key:"create",value:function(){var t=this.game.add.sprite(this.game.world.centerX,this.game.world.centerY,"ball");this.game.physics.arcade.enable(t),t.anchor.setTo(.5,.5),p(t).collideWorldBounds=!0,p(t).bounce.setTo(1,1);var e=new b(this.game.world,t);return this.last.update(e),e}},{key:"value",value:function(){return this.last.value()}}]),t}(),k=function(){function e(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.Signal;a(this,e),this.game=n,this.changedObj=i}return r(e,[{key:"play",value:function(){return this.game.paused=!1,this.changedObj.dispatch(this.game.paused),this}},{key:"pause",value:function(){return this.game.paused=!0,this.changedObj.dispatch(this.game.paused),this}},{key:"toggle",value:function(){return this.game.paused?this.play():this.pause(),this}},{key:"changed",value:function(){return this.changedObj}},{key:"update",value:function(){return this}}]),e}(),w=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y;a(this,t),this.game=e,this.last=n}return r(t,[{key:"create",value:function(){var t=new k(this.game);return t.pause(),this.game.input.onDown.add(function(){t.toggle()}),this.last.update(t),t}},{key:"value",value:function(){return this.last.value()}}]),t}(),m=function(){function t(e,n,i){a(this,t),this.spriteObj=e,this.minY=n,this.maxY=i}return r(t,[{key:"setPositionY",value:function(t){return this.spriteObj.y=t,this.spriteObj.y<this.minY?this.spriteObj.y=this.minY:this.spriteObj.y>this.maxY&&(this.spriteObj.y=this.maxY),this}},{key:"setVelocityY",value:function(t){return p(this.spriteObj).velocity.y=t,this}},{key:"setMaxVelocityY",value:function(t){return p(this.spriteObj).maxVelocity.y=t,this}},{key:"sprite",value:function(){return this.spriteObj}},{key:"update",value:function(){return this}}]),t}(),O=function(){function t(e,n){a(this,t),this.game=e,this.location=n}return r(t,[{key:"create",value:function(){var t=this.game.add.sprite(this.location.value().x,this.location.value().y,"paddle");t.anchor.setTo(.5,.5),this.game.physics.arcade.enable(t),p(t).collideWorldBounds=!0,p(t).immovable=!0,t.scale.setTo(.5,.5);var e=.5*t.height,n=this.game.world.height-.5*t.height;return new m(t,e,n)}}]),t}(),j=function(){function e(n,i,r){var u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.Signal;a(this,e),this.game=n,this.ball=i,this.paddles=r,this.collidedObj=u}return r(e,[{key:"collided",value:function(){return this.collidedObj}},{key:"update",value:function(){var t=this;return this.paddles.forEach(function(e){t.game.physics.arcade.collide(e.sprite(),t.ball.sprite(),function(){t.collidedObj.dispatch()},void 0,t)}),this}}]),e}(),S=function(){function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new y;a(this,t),this.game=e,this.ball=n,this.players=i,this.last=r}return r(t,[{key:"create",value:function(){var t=new j(this.game,this.ball.value(),this.players.values().map(function(t){return t.paddle()}));return this.last.update(t),t}},{key:"value",value:function(){return this.last.value()}}]),t}(),x=function(){function t(e,n,i,r){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:450;a(this,t),this.idNumber=e,this.anchor=n,this.paddleObj=i,this.scoreObj=r,this.maxVelocity=u}return r(t,[{key:"id",value:function(){return this.idNumber}},{key:"score",value:function(){return this.scoreObj}},{key:"paddle",value:function(){return this.paddleObj}},{key:"update",value:function(){return this.paddleObj.setVelocityY(this.anchor.y),this.paddleObj.setMaxVelocityY(this.maxVelocity),this}}]),t}(),_=function(){function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l;a(this,t),this.ball=e,this.paddleFactory=n,this.scoreFactory=i,this.entities=r}return r(t,[{key:"create",value:function(){var t=new x(1,this.ball.value().body().velocity,this.paddleFactory.create(),this.scoreFactory.create());return this.entities.add(t),t}},{key:"values",value:function(){return this.entities.values()}}]),t}(),P=function(){function t(e,n,i,r){a(this,t),this.idNumber=e,this.input=n,this.paddleObj=i,this.scoreObj=r}return r(t,[{key:"id",value:function(){return this.idNumber}},{key:"score",value:function(){return this.scoreObj}},{key:"paddle",value:function(){return this.paddleObj}},{key:"update",value:function(){return this.paddleObj.setPositionY(this.input.y),this}}]),t}(),F=function(){function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new l;a(this,t),this.input=e,this.paddleFactory=n,this.scoreFactory=i,this.entities=r}return r(t,[{key:"create",value:function(){var t=new P(0,this.input.value(),this.paddleFactory.create(),this.scoreFactory.create());return this.entities.add(t),t}},{key:"values",value:function(){return this.entities.values()}}]),t}(),L=function(){function e(n,i,r){var u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.Signal;a(this,e),this.ball=n,this.players=i,this.pause=r,this.scoredSignal=u}return r(e,[{key:"score",value:function(t){t.score().increase();var e=0===t.id();return this.ball.reset(e),this.pause.pause(),this.scoredSignal.dispatch(t),this}},{key:"scored",value:function(){return this.scoredSignal}},{key:"start",value:function(){return this.ball.isLaunched()||this.ball.launch(),this}},{key:"update",value:function(){var t=this.ball.body().blocked;return t.left?this.score(this.players[1]):t.right&&this.score(this.players[0]),this}}]),e}(),Y=function(){function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new y;a(this,t),this.ball=e,this.players=n,this.pause=i,this.last=r}return r(t,[{key:"create",value:function(){var t=new L(this.ball.value(),this.players.values(),this.pause.value());return this.pause.value().changed().add(function(e){e||t.start()}),this.last.update(t),t}},{key:"value",value:function(){return this.last.value()}}]),t}(),M=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;a(this,t),this.bitmapText=e,this.value=n}return r(t,[{key:"increase",value:function(){return this.value+=1,this.bitmapText.text=""+this.value,this}},{key:"update",value:function(){return this}}]),t}(),T=function(){function t(e,n){a(this,t),this.factory=e,this.location=n}return r(t,[{key:"create",value:function(){return new M(this.factory.value().bitmapText(Math.floor(this.location.value().x),Math.floor(this.location.value().y),"Press Start 2P","0",32))}}]),t}();var E=function(t){function e(t){a(this,e);var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.factories=t,n.entities=[],n}return u(e,t),r(e,[{key:"create",value:function(){this.entities=this.factories.map(function(t){return t.create()})}},{key:"update",value:function(){this.entities.forEach(function(t){t.update()})}}]),e}(t.State);var V,C,W,A,H=new t.Game({width:1024,height:576,renderer:t.AUTO,parent:"game-container"});(V=H,C={boot:(A="game",new o(A,{image:[{key:"paddle",url:"images/paddle.png"},{key:"ball",url:"images/ball.png"}],bitmapFont:[{key:"Press Start 2P",textureUrl:"fonts/Press_Start_2P_0.png",atlasUrl:"fonts/Press_Start_2P.fnt"}],audio:[{key:"hit",urls:["audio/hit.wav"]},{key:"score",urls:["audio/score.wav"]},{key:"wall",urls:["audio/wall.wav"]},{key:"music",urls:["audio/at-night-psg.mp3","audio/at-night-psg.ogg"]}]})),game:function(t){var e=new l,n=new g(t),i=new w(t),a=new Y(n,e,i),r=new S(t,n,e);return new E([new d(new c(function(){return t.add})),i,n,function(t,e,n){return new _(e,new O(t,new c(function(){return{x:t.world.width-8,y:t.world.centerY}})),new T(new c(function(){return t.add}),new c(function(){return{x:t.world.width-128,y:128}})),n)}(t,n,e),function(t,e){return new F(new c(function(){return t.input}),new O(t,new c(function(){return{x:0,y:t.world.centerY}})),new T(new c(function(){return t.add}),new c(function(){return{x:128,y:128}})),e)}(t,e),a,r,new v(new c(function(){return t.sound}),n,r,a)])}(H)},W=function(e){return e instanceof t.StateManager?e:e.state}(V),Object.keys(C).forEach(function(t){W.add(t,C[t])}),W).start("boot")}(Phaser);
